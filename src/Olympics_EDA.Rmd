---
title: "Olympics Report"
date: '2022-06-21'

output: 
  html_document:
    toc : true
    number_sections: true
    toc_float : true
    code_folding: hide



---

```{r setup, include=FALSE}
knitr::opts_chunk$set(comment = NA, results='hide', message = FALSE, warning = FALSE)
```
```{r }
#loading reqiuerd packages
library(plyr)
library(dplyr)
library(tidyverse)
library(skimr)
library(rworldmap)
library(repr)
library(DT)
library(janitor)
library(GGally)
library(here)
library(kableExtra)
library(tidytuesdayR)

#import data 
tuesdata <- tidytuesdayR::tt_load("2021-07-27")
# Individual dataframes
olympics <- tuesdata$olympics

# A second dataframe is available
# It is not required, but may prove useful in certain cases
regions <- tuesdata$regions
olympics$medal <- factor(olympics$medal,levels = c("Gold","Silver","Bronze"))
olympics$season <- factor(olympics$season,levels = c("Summer","Winter"))
olympics$sex <-  factor(olympics$sex,levels = c("M","F"))

```

# DATA 

The dataset contains the following variables:


| Variable | Type      | Description                                    |
|----------|-----------|------------------------------------------------|
| id       | double    | Athlete unique ID                              |
| name     | character | Athlete Name                                   |
| sex      | character | Athlete Sex                                    | 
| age      | double    | Athlete Age                                    |
| height   | double    | Athlete Height (cm)                            | 
| weight   | double    | Athlete weight (kg)                            |
| team     | character | Team name, typically a country name            |
| noc      | character | NOC 3-letter country code                      |
| games    | character | 4-digit year + season                          |
| year     | double    | 4-digit year                                   | 
| season   | character | Season                                         |
| city     | character | Host city                                      | 
| sport    | character | Sport                                          |
| event    | character | Sport + Event Name                             |
| medal    | character | Medal: Gold, Silver, Bronze, (plus NA values)  |

You can access the dataset directly from base package.

The detailed summary for every type as follow


```{r results='markup'}

olympics %>% skim_without_charts()


```

# EDA 
average wight of all Olympics participants since 1896


```{r results='markup'}
olympics %>% 
  filter(!is.na(weight)) %>% 
  summarise(mean = mean(weight)) %>% 
  print.table()
```
average height of all Olympics participants since 1896

```{r results='markup'}
olympics %>% 
  filter(!is.na(height)) %>% 
  summarise(mean = mean(height))%>% 
  print.table()
```
average age of all Olympics participants since 1896
```{r results='markup'}
olympics %>% 
  filter(!is.na(age)) %>% 
  summarise(mean = mean(age))%>% 
  print.table()
```
## how did the numbers of female and male athlete changed over time
```{r}
#count the number of females and males for each year
counts_sex <- olympics %>% 
  group_by(year, sex) %>%
  summarize(Count = length(unique(id))) %>%
  spread(sex, Count)

#clean the data
counts_sex$M[is.na(counts_sex$M)] <- 0
counts_sex$F[is.na(counts_sex$F)] <- 0
counts_sex$year <- as.factor(counts_sex$year)

#calculate the total on participants 
counts_sex <- mutate(counts_sex,Total = sum(M,F,na.rm=T)) 

#calculate the percentage of females and males from the total
counts_sex$M <- counts_sex$M/counts_sex$Total
counts_sex$F <- counts_sex$F/counts_sex$Total

#creating the graph
names(counts_sex)[2:3] <- c("Male","Female")
counts_sex <- gather(counts_sex,key= sex , value = Count,2:3)

ggplot(counts_sex,aes(x=year,y=Count,fill=sex)) +
  geom_col() +
  coord_flip() 
```


## who got the most medals 
```{r}

olympics %>% 
  filter(!is.na(medal)) %>% 
  group_by(name) %>% 
  summarise(name , total = length(medal)) %>%  distinct() %>% 
  arrange( desc(total)  ) %>%  head(10)  -> medalyPerson


medalyPerson %>% 
ggplot(aes(reorder(name,total) , total)) + geom_bar(stat =  "identity") +theme(axis.text.x = element_text(angle = 90)) + coord_flip()
```





## changes of athletes' height,weight and BMI over time {.tabset}

### Height
```{r}
olympics %>% 
  filter(!is.na(height)) %>% 
  group_by(year) %>% 
  summarise( height= mean(height))-> avgHight

ggplot(avgHight , aes(year , height)) + geom_point()+ geom_smooth(se = FALSE)
```

### Weight
```{r}
olympics %>% 
  filter(!is.na(weight)) %>% 
  group_by(year) %>% 
  summarise( weight= mean(weight))-> avgWeight

ggplot(avgWeight , aes(year , weight)) + geom_point()+ geom_smooth(se = FALSE)
```

### BMI

```{r}
avgBMI <- avgHight
avgBMI$weight <- avgWeight$weight

avgBMI <- avgBMI %>% 
  mutate(bmi = (weight)/(height/100 * height/100))

ggplot(avgBMI ,aes(year , bmi) )+ geom_point()+ geom_smooth(se = FALSE)
```

## did WW1 and WW2 affect the number of participated countries ?

### How did the Olympics suffer from the WWII

```{r}
medal2 <-
  olympics %>% 
  group_by(year, medal = medal=="Gold" , season) %>% #the idea here is when we group by medal = gold this will show us the number of games (one medal per game)
  
  summarise(
    TotalMedal = length(medal) ## i dont know whay na.rm do yet but when i remove it the graph change a lot
  )


medal2 %>% 
  filter(medal , medal == TRUE)    ->medal ##the idea here is will count the number of true(medal == gold) in each year summer or 

ggplot(medal , aes(year , TotalMedal  , color = season)) + geom_line() +
  geom_point(aes(x=1920, y=470), size=30, shape=1, color="gold4") +
  geom_point(aes(x=1945, y=300), size=30, shape=1, color="gold4") +
  labs(title ="WWII & Olympcs " ,y = "Total Games", x = "YEAR of the event" , caption = "*the circles shows the start and the end of the war \n this also shows that the winter olympics started in the middle of the war  ") +
  # please change the title to good name
  theme_bw() + theme(legend.position = c(.05,.92) , )

```

### Germany in wrold war 2 

```{r}
olympics %>% 
  group_by(team , year ) %>% 
  filter(grepl("Germany", team)) %>% 
  
  # filter(team == "Germany" | team == "*Germany" ) %>% 
  summarise( team , year , numberOfParticipants= length(name) ,season) %>% 
  distinct() -> GermanyDataset

GermanyDataset  %>% 
  ggplot(aes(year ,numberOfParticipants , color = team )) + geom_bar(stat = "identity")+ ##  I dont like this plot but  
  
  facet_grid(. ~ season) +
  labs(title = "Germany during WWII era" , caption = " between 1920 to 1945 Germany have not played any olympics except 3   ") 




```


## does the age of the athlete effect on his/her performance?
The avg age in each year

```{r}
olympics %>% 
  select(year , team,age) %>%
  filter(!is.na(age)) %>% 
  group_by(year) %>% 
  summarise(age = mean(age)) -> avrgAgeInEachYear 

ggplot(avrgAgeInEachYear , aes(year , age)) + geom_point()+ geom_smooth(se = FALSE)

winnersVslosers <- olympics %>% 
  mutate(winner = if_else(is.na(medal),"loser","winner"))
```

### How old are most of the winners and losers?

```{r}
winnersVslosers$winner <- factor(winnersVslosers$winner,levels = c("loser","winner")) 

winnersVslosers %>%
  filter(!is.na(age)) %>% 
  group_by(winner,age) %>% 
  summarise(count=n()) -> winnersVslosers

#plot
winnersVslosers %>% 
  ggplot(aes(x=age ,fill= winner)) +
  geom_density(alpha=0.25)

```

## Top 10 teams with respect to number of medals

```{r}
# count number of medals for each team
medal_counts <- olympics %>% filter(!is.na(medal))%>%
  group_by(team, medal) %>%
  summarize(Count=length(medal))

# order team by total medal count
levs_art <- medal_counts %>%
  group_by(team) %>%
  summarize(Total=sum(Count)) %>%
  arrange(Total) %>%
  select(team) %>% 
  tail(n=20)

medal_counts$team <- factor(medal_counts$team, levels=levs_art$team)
medal_counts <- medal_counts %>% filter(!is.na(team))


# plot
ggplot(medal_counts, aes(x=team, y=Count, fill=medal)) +
  geom_col() +
  coord_flip() +
  scale_fill_manual(values=c("gold1","gray70","gold4")) +
  theme(plot.title = element_text(hjust = 0.5))+
  labs(x="Team",y="Number of Medals athletes since 1896")
```

##  With respect with medal type (gold , silver ,bronze)

```{r}
medal_countsALL <- olympics %>% filter(!is.na(medal))%>%
  group_by(team) %>%
  summarize(Count = length(medal)) 

medal_countsALL <- medal_countsALL[order(medal_countsALL$Count, decreasing = TRUE), ] %>% head(10)

ggplot(medal_countsALL , aes(Count , team )) + geom_bar(stat =  "identity")

```


## Number of football medals by each team from 2000-2016

```{r}
football_teams_medals<- olympics %>%
  filter(sport == "Football", year >= 2000,!is.na(medal)) %>%
  group_by(team) %>%
  summarise(count=n()) %>% 
  arrange(count)
#plot
football_teams_medals %>% 
  ggplot(aes( x= reorder(team,count),y= count)) +
  geom_col() +
  coord_flip() +
  labs(x="Team",y="Number of Football Medals from 2000 to 2016")
```

## Number of athletes per countery 
```{r}
olympics %>%
  group_by(noc) %>%
  count(name) %>%
  summarise(count = sum(n)) %>% 
  arrange(count) %>% 
  tail(n=20) %>% 
  
#plot
ggplot(aes(x= reorder(noc,count), y=count)) +
 geom_col() +
 coord_flip() +
 labs(x="Team",y="Number of Olympics athletes since 1896")

```

## Mean of age in year With respect of kind of model 

```{r}
medal <-
  olympics %>% 
  filter(!is.na(age),!is.na(medal)) %>% 
  group_by(year, medal) %>% 
  summarise(age = mean(age))

#plot
ggplot(medal , aes(x=year , y=age, color = medal)) + geom_line() +
scale_color_manual(values=c("gold1","gray70","gold4")) 
  



```

```{r}


AgeAndHowManyGold <-
  olympics %>%
  group_by(year,age, medal) %>% 
  filter(medal == "Gold",!is.na(age)) %>% 
  summarise(count = n() ) 




   medal <- olympics %>% 
  group_by(year, medal) %>% 
  
  summarise(
    age = mean(age, na.rm = TRUE ) ## i dont know whay na.rm do yet but when i remove it the graph change a lot
    , season =season
  )  


   
   AgeAndHowManyMedal <-
     olympics %>%
     group_by(year,age, medal) %>% 
     filter(!is.na(medal),!is.na(age)) %>% 
     summarise(count = n() ) 
   


```

```{r}

###--- plot for medal per year 

ggplot(medal , aes(x=year , y= age  , color = medal )) + geom_line() +   facet_grid(. ~ season) #summer and winter game 



```

```{r}

ggplot(AgeAndHowManyGold , aes(x=year ,age   ,size = count)) + geom_point()  ## this will show only gold medal 


```

```{r}

ggplot(AgeAndHowManyMedal , aes(x=year ,age , color = medal  ,size = count)) +  geom_jitter(alpha = 0.8, shape = 16 , width =1) +
  coord_fixed() + scale_color_brewer(palette = "BrBG") ## this will show ALL medal 
```


# Conclusion 
